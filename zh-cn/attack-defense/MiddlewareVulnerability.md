# 常见中间件漏洞分析

```java
各种CVE漏洞或其他漏洞利用，
1.可以在github/google/百度 搜索利用方式
2.可以通过shodan搜索开放的各类服务
3.也可以扫描互联网各个网段的服务。
```





# 1.weblogic

## 1.1 概述

```java
WebLogic是美国Oracle公司出品的一个application server，
确切的说是一个基于JAVAEE架构的中间件，
WebLogic是用于开发、集成、部署和管理大型分布式Web应用、网络应用和数据库应用的Java应用服务器。
将Java的动态功能和Java Enterprise标准的安全性
引入大型网络应用的开发、集成、部署和管理之中。
```

## 1.2 基本特征

```java
1.端口：
默认 7001
2.web界面：
Error 404 -- Not Found
```

## 1.3 历史漏洞

```java
CVE-2017-10271
CVE-2019-2725
CVE-2020-2555
CVE-2018-2628
cVE-2019-2729
CVE-2018-2893
cVE-2019-2890
CVE-2018-2894
weblogic弱口令
CVE-2018-3191
weblogic ssrf
CVE-2018-3245
CVE-2020-2551
cVE-2019-2618
CVE-2020-2883
```

## 1.4 漏洞利用

### 1.4.1 获取资产

```java
shodan, fofa, 钟馗之眼等
搜索关键词：app="BEA-WebLogic-Server"

google hacking
搜索关键词：
inurl:漏洞地址
intitle:weblogic等
```

### 1.4.2 批量扫描脚本

```java
1.下载
https://github.com/rabbitmask/WeblogicScan

2.安装依赖
pip3 install -r requirements.txt 

3.运行
python3 WeblogicScan.py 192.168.1.1 7001
或者
python3 WeblogicScan.py -f target.txt
```

### 1.4.3 漏洞利用

```java
可搜索一下上一步扫描出来的漏洞如何利用，然后利用burp或者其他工具进行处理。
```

# 2.ThinkPHP5

## 2.1 概述

```java
ThinkPHP是一个快速、兼容而且简单的轻量级国产PHP开发框架，诞生于2006年初，
原名FCS，2007年元旦正式更名为ThinkPHP，遵循Apache2开源协议发布，
从Struts结构移植过来并做了改进和完善，同时也借鉴了国外很多优秀的框架和模式，
使用面向对象的开发结构和MVC模式，融合了Struts的思想和TagLib（标签库)、
RoR的ORM映射和ActiveRecord模式。

ThinkPHP可以支持windows/Unix/Linux等服务器环境，正式版需要PHP5.0以上版本支持，
支持MySql、PgSQL、Sqlite多种数据库以及PDO扩展，
ThinkPHP框架本身没有什么特别模块要求，具体的应用系统运行环境要求视开发所涉及的模块。
```

## 2.2 基本特征

```java
很多cms就是基于thinkphp5二次开发的，所以thinkphp出问题的话，
会影响很多基于thinkphp开发的网站。
```

## 2.3 历史漏洞

```java
ThinkPHP3.2.3_缓存函数设计缺陷可导致Getshell
ThinkPHP5_SQL注入漏洞&&敏感信息泄露
ThinkPHP3.2.3_最新版update注入漏洞
ThinkPHP5.0.10缓存函数设计缺陷可导致Getshell
ThinkPHP3.2.X_find_select_delete注入
ThinkPHP框架5.0.x_sql注入漏洞分析
ThinkPHP3.X_order_by注入漏洞
ThinkPHP5.X_order_by注入漏洞
ThinkPHP5.X_远程代码执行
```

## 2.4 漏洞利用

### 2.4.1 远程代码执行漏洞

```php
其5.0.23以前的版本中，获取method的方法中没有正确处理方法名，
导致攻击者可以调用Request类任意方法并构造利用链，从而导致远程代码执行漏洞。
```

### 2.4.2 批量扫描脚本

```php
https://github.com/admintony/thinkPHPBatchPoc
```



# 3.Struts2

## 3.1 概述

```java
一个MVC框架
```

## 3.2 历史漏洞

```java
[+]S2-001:影响版本Struts 2.0.0-2.0.8; 
POST请求发送数据;默认参数为:username,password;支持获取WEB路径,任意命令执行和反弹shell

[+]S2-003:影响版本Struts 2.0.0-2.0.11.2; 
GET请求发送数据;支持任意命令执行

[+]S2-005:影响版本Struts 2.0.0-2.1.8.1; 
GET请求发送数据;支持获取WEB路径,任意命令执行

[+]S2-007:影响版本Struts 2.0.0-2.2.3; 
POST请求发送数据;默认参数为:username,password;支持任意命令执行和反弹shell

... ...
```

## 3.3 漏洞利用

### 3.3.1 扫描工具

```java
Struts2 漏洞检查工具。
https://github.com/HatBoy/Struts2-Scan
```



# 4.JBOSS

## 4.1 概述

```java
一个基于J2EE的开放源代码的应用服务器。
JBoss是一个管理EJB的容器和服务器，但JBoss核心服务不包括支持servlet/JSP的WEB容器，
一般与Tomcat或Jetty绑定使用。Jboss是Java EE应用服务器（就像Apache是web服务器一样)，
专门用来运行Java EE程序的。
```

## 4.2 历史漏洞

```java
// 访问控制不严导致的漏洞
JMX Console未授权访问Getshell
JMX Console HtmlAdaptor Getshell (CVE-2007-1036)
JMX控制台安全验证绕过漏洞(CVE-2010-0738)
Administration Console弱口令Getshell

// 反序列化漏洞
JBoss JMXInvokerServlet反序列化漏洞(CVE-2015-7501)
JBoss EJBInvokerServlet反序列化漏洞
JBosS AS 6.X反序列化漏洞(CVE-2017-12149)
JBoss 4.x JBossMQ JMS反序列化漏洞(CVE-2017-7504)
```

## 4.3 漏洞利用

### 4.3.1 批量检测脚本

```java
https://github.com/GGyao/jbossScan
```



# 5.fastjson

## 5.1 概述

```java
Fastjson是阿里巴巴公司开源的一款json解析器，其性能优越，
被广泛应用于各大厂商的Java项目中。
```

## 5.2 历史漏洞

```java
1.2.24: 
fastjson在解析json的过程中，支持使用autoType来实例化某一个具体的类，
并调用该类的set/get方法来访问属性。通过查找代码中相关的方法，即可构造出一些恶意利用链。

1.2.27:
fastjson于1.2.24版本后增加了反序列化白名单，而在1.2.48以前的版本中，
攻击者可以利用特殊构造的json字符串绕过白名单检测，成功执行任意命令。
```



## 5.3 漏洞利用

### 5.3.1 如何判断是否使用了 fastjson

```java
fastjson的作用是用于对JSON格式的数据进行解析和打包,
所以出现json格式的地方就有可能使用了fastjson。
```


